<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>COET Bot</title>
  <link rel="icon" href="{{ url_for('static', filename='images/icon.png') }}" type="image" sizes="16x16">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='assets/bootstrap/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/fonts/ionicons.min.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/Login-Form-Dark.css') }}">

</head>

<body>
  <section class="msger">
   

      <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <!--a class="navbar-brand" href="#">COET Bot</a-->
        <a class="navbar-brand" href="#" style="color: white;">
          &emsp;<i class="fas fa-graduation-cap"></i> <b> &nbsp; COET BOT &emsp; </b></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ml-auto">

            
            <li class="nav-item active"><a class="nav-link" href="/index">Home</a></li>

            
            <li class="nav-item">
              <a class="nav-link" data-toggle="modal" data-target="#exampleModalScrollable" href="#"> About Us </a>
             </li>

            <li class="nav-item">
              <a class="nav-link" data-toggle="modal" data-target="#exampleModal" href="#">Suggestion box</a>
            </li>


            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Suggestion box</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <form action='/suggestion' method='POST'>
                      <div class="form-group">
                        <input type="email" name='uemail' class='form-control' placeholder="Email" required>
                        <br>
                        <textarea class="form-control" id="message-text" placeholder="Enter your suggestion..." name="message" required></textarea>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="Submit" class="btn btn-primary" data-target="#alert">Submit</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal fade" id="exampleModalScrollable" tabindex="-1" role="dialog"
              aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
              <div class="modal-dialog modal-dialog-scrollable" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalScrollableTitle">COET BOT </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                   <h3>About Us</h3>
                   <div><img src="https://www.cethalassery.ac.in/images/gallery/gal40.jpg" height="auto" width="100%" style="border: 3px solid black;"></div>
                    <br> <br>
                   <p style="text-align: justify;">Located in a picturesque environment in the heart of the Kannur, College of Engineering Thalassery (COET). The Institute is dedicated to make a different engineering experience, with its exclusive approach towards the ongoing momentum of trends in technology and holistic development.</p>

                    <p style="text-align: justify;">The institute has today grown into a full-fledged Technical Complex and we dedicate highly-qualified trained engineers and technicians for the service of our country.</p>
                    
                    <p style="text-align: justify;">The College of Engineering, Thalassery was established in the year 2000. Thalassery, the cradle of colonial legacy that is known for its scenic beauty and prominence in the educational field from ancient times. The foundation stone was laid by Sri E.K Nayanar, the then Honorable Cheif Minister of Kerala. The college in the new building complex was officially inaugurated by Sri. M.V Raghavan, the then Honorable Minister of Co-operation and Ports in the year 2004. It is located at Kundoormala, Eranholi (West Ponniam) 6.5 km east of Thalassery town in Kannur (Cannanore) district. The college is situated on a hilltop with the Arabian Sea on one side and the Western Ghats on the other.The sprawling campus spread over 25 acres of land provides an ideal atmosphere for the pursuit of knowledge.</p>

                    <p style="text-align: justify;">The College is affiliated to the Cochin University of Science and Technology (CUSAT). The College Offers B-Tech courses in the following five Engineering streams with a sanctioned strength of 66 students in each branch per year. Admission to this college is purely based on the Common Entrance Examination (CEE) conducted by the Govt. of Kerala. The students of this college are getting top ranks right from the first batch itself among the colleges under CUSAT. This college is the choice of top rank holders in the CEE. This college has made a distinction in discipline, quality teaching and in excellence of students.</p>

                    <p style="text-align: justify;">The Courses offered are Computer Science & Engineering, Electronics & Communication Engineering, Electrical & Electronics Engineering, Information Technology, Mechanical Engineering. The duration of each course is four academic years as prescribed in the curriculum. The first two semesters will be combined together as first year, and the remaining three years consists of  six semesters. Examinations will be conducted at the end of the year/semester.</p>
                    <h3>Contact Us</h3>
                    
                    <ul>
                    
                    <li style = "margin-left:15px">Email: coethelp@gmail.com</li>
                    <li style = "margin-left:15px">By Nihad, Akshay, Roshit & Shibu ðŸ˜Š </li>
                    </ul>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
            <li class="nav-item"><a class="nav-link" href="/logout">Log Out</a></li>
            
          </ul>
        </div>
    
   
    </nav>
    <!--header class="msger-header">
      <div class="msger-header-title">
        <h5><i class="fas fa-graduation-cap"></i> <b> &emsp; COET BOT &emsp; </b><i class="fas fa-graduation-cap"></i></h5>
      </div>
    </header-->
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-success alert-dismissible" id="alert" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      <strong>{{ message }}</strong>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}
   
   
    <main class="msger-chat" style="color: white;">
    </br>
      <div class="msg left-msg">       
        <div class="msg-img" style = "background-image: url(https://t4.ftcdn.net/jpg/02/23/38/61/240_F_223386120_OMJd0gW045lI3TGy4UfUDOzOKvcrDWLR.jpg)">
        </div>
        <div class="msg-bubble">
          <div class="msg-info">
            <div class="msg-info-name"><b>COET BOT</b> </div>
          </div>      
              
          <div class="msg-text" style="color: white;">
            <b >Hi there, Welcome to COET! ðŸ‘‹ If you need any assistance, I'm always here.
          </div>
        </div>
      </div> 
      <div class="msg left-msg">       
        <div class="msg-img" style = "background-image: url(https://t4.ftcdn.net/jpg/02/23/38/61/240_F_223386120_OMJd0gW045lI3TGy4UfUDOzOKvcrDWLR.jpg)">
        </div>
        <div class="msg-bubble">
          <div class="msg-info">
            <div class="msg-info-name"> <b>COET BOT</b></div>
          </div>      
              
          <div class="msg-text" style="color: white;">
           Which of the following user groups do you belong to?
            
              <br><br>1.&emsp;Student's Section Enquiry.</br>2.&emsp;Faculty Section Enquiry. </br>3.&emsp;Parent's Section Enquiry.</br>4.&emsp;Visitor's Section Enquiry.</br>
    
        </div>               
          
        </div>
      </div>

    </main>

    <form class="msger-inputarea">
      <button type="submit" class="toggleTTS"><i class="fa-solid fa-volume-xmark"></i></button>
      <input type="text" class="msger-input" id="textInput" placeholder="Enter your enquiry number...">
      <button type="submit" class="msger-send-btn"><i class="fa-regular fa-paper-plane"></i></button>
      <button onclick="runSpeechRecog()" class="input-icon"><i class="fa-solid fa-microphone"></i></button>
    </form>
  </section>
  <!-- partial -->
  <script src='https://use.fontawesome.com/releases/v5.0.13/js/all.js'></script>
  <script>

    $("#alert").delay(3000).slideUp(200, function() {
    $(this).alert('close');
    });

    $('#myModal').on('shown.bs.modal', function () {
      $('#myInput').trigger('focus')
    })
    
    const toggleTTSButton = document.querySelector('.toggleTTS');
    let isTTSenabled = false;
    toggleTTSButton.addEventListener('click', () => {
      isTTSenabled = !isTTSenabled;
      if (isTTSenabled) {
        toggleTTSButton.innerHTML = '<i class="fas fa-volume-up"></i>';
      } else {
        toggleTTSButton.innerHTML = '<i class="fa-solid fa-volume-xmark"></i>';
        window.speechSynthesis.cancel();
      }
    });

    const chatInput = document.querySelector('.msger-input');
    const sendBtn = document.querySelector('.msger-send-btn');
    const inputIcon = document.querySelector('.input-icon');

    chatInput.addEventListener('input', () => {
      if (chatInput.value.trim() !== '') {
        sendBtn.style.display = 'block';
        inputIcon.style.display = 'none';
      } else {
        sendBtn.style.display = 'none';
        inputIcon.style.display = 'block';
      }
    });

    sendBtn.addEventListener('click', () => {
      sendBtn.style.display = 'none';
      inputIcon.style.display = 'block';
    });


    const msgerForm = get(".msger-inputarea");
    const msgerInput = get(".msger-input");
    const msgerChat = get(".msger-chat");


    // Icons made by Freepik from www.flaticon.com
    const BOT_IMG = "https://t4.ftcdn.net/jpg/02/23/38/61/240_F_223386120_OMJd0gW045lI3TGy4UfUDOzOKvcrDWLR.jpg";
    const PERSON_IMG = "https://img.freepik.com/free-vector/businessman-character-avatar-isolated_24877-60111.jpg?size=626&ext=jpg&ga=GA1.2.1720146144.1687693217&semt=sph";
    const BOT_NAME = "COET Bot";
    const PERSON_NAME = "You";

    runSpeechRecog = () => {
      let recognization = new webkitSpeechRecognition();
      recognization.onstart = () => {
        inputIcon.style.color = "red";
      }
      recognization.onresult = (e) => {
        inputIcon.style.color = "black";
        var transcript = e.results[0][0].transcript;
        const msgText = transcript;
        appendMessage(PERSON_NAME, PERSON_IMG, "right", msgText);
        msgerInput.value = "";
        botResponse(msgText);
      }
      recognization.start();
    }

    msgerForm.addEventListener("submit", event => {
      event.preventDefault();
      window.speechSynthesis.cancel();
      const msgText = msgerInput.value;
      if (!msgText) return;

      appendMessage(PERSON_NAME, PERSON_IMG, "right", msgText);
      msgerInput.value = "";
      botResponse(msgText);
    });

    function appendMessage(name, img, side, text) {
      //   Simple solution for small apps
      const msgHTML = `
<div class="msg ${side}-msg">
  <div class="msg-img" style="background-image: url(${img})"></div>

  <div class="msg-bubble">
    <div class="msg-info">
      <div class="msg-info-name">${name}</div>
      <div class="msg-info-time">${formatDate(new Date())}</div>
    </div>

    <div class="msg-text">${text}</div>
  </div>
</div>
`;

      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop += 500;
    }

    function botResponse(rawText) {

      // Bot Response
      $.get("/get", { msg: rawText }).done(function (data) {
        console.log(rawText);
        console.log(data);
        const msgText = data;
        startTTS(msgText);
        appendMessage(BOT_NAME, BOT_IMG, "left", msgText);
      });

    }

    
    function startTTS(message) {
      if (isTTSenabled) {
        // speak message
        const speech = new SpeechSynthesisUtterance(message);
        window.speechSynthesis.speak(speech);
      } else {
        // Stop speech synthesis if currently speaking
        window.speechSynthesis.cancel();
      }
    }

    // Utils
    function get(selector, root = document) {
      return root.querySelector(selector);
    }

    function formatDate(date) {
      const h = "0" + date.getHours();
      const m = "0" + date.getMinutes();

      return `${h.slice(-2)}:${m.slice(-2)}`;
    }

  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
</body>

</html>
